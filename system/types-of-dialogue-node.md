# 对话节点类型

本节内容是对话节点类型的详细说明，包括节点类型的定义、节点类型的属性、节点类型的使用场景等。
- `nodeType` 字段定义了节点的类型，不同的节点类型会有不同的行为。
- `nodeOptions` 字段定义了节点的配置项，不同的节点类型会有不同的配置项。


## 普通对话节点

### 节点定义

`nodeType` 的值为 `[0]普通对话节点` 时，表示该节点为普通对话节点。

### 节点示例

| [nodeType]对话类型 | [nodeOptions]节点设置 | [dialogText]对话内容文本 |
|----------------|-------------------|--------------------|
| [0]普通对话节点      |                   | 这是一句普通的对话文本。       |

### 相关属性

| 字段名                     | 说明                                                                                                   | 示例                                                                          |
|-------------------------|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| [nodeOption]节点设置        | 普通对话节点无节点设置项，故此项固定为空                                                                                 |                                                                             |
| [bgpName]背景图变更          | 相当于直接调用 [行级脚本 SetLayerMedia](../scripts/line-scripts#setlayermedia-设置背景图层媒体)，与可填入的参数格式一致             | `p=Background, m=Fantasy Landscape, blend=hurricane, aud=true`              |
| [bgmName]音乐变更           | 相当于直接调用 [行级脚本 PlaySong](../scripts/line-scripts#playsong-播放背景音乐)，与可填入的参数格式一致                         | `Theme_21, l=true`                                                          |
| [characterTempId]角色模板Id | 说话人的模板Id，决定说话人的立绘、名称等的默认配置                                                                           |                                                                             |
| [characterCode]角色代码     | 当多个角色使用同一个模板时，用于给角色做区分                                                                               |                                                                             |
| [speakerName]对话角色名文本    | 可为空，若不为空将会强制将对话者的姓名改为所填内容                                                                            |                                                                             |
| [dialogText]对话内容文本      | 对话的实际文本                                                                                              | `这是一句<color=red>普通的</color>对话文本。`                                           |
| [tachiePosition]立绘入场位置  | 二元数组，分别代表立绘在横轴和纵轴上的位置，纵轴0代表贴左边缘，1代表贴右边缘，横轴0代表贴下边缘，1代表贴上边缘                                            | `[1, 0]`                                                                    |
| [tachieEnterType]立绘入场方式 | 当前接受两个值 `direct` , `fade` 代表直接显示和淡入，相当于直接调用 [行级脚本 Show](../scripts/line-scripts-character#show-显示角色) |                                                                             |
| [tachieStatus]立绘状态      | 设定立绘的状态，若不指定会使用默认状态，相当于直接调用 [行级脚本 SetSprite](../scripts/line-scripts-character#setsprite-设置立绘)       | `smile, l=0`                                                                |
| [commandsOnStart]开始触发   | 在对话开始时触发的脚本，格式遵循 [行级脚本](../scripts/line-scripts)                                                     | PlaySFX(thunder_strong_01, l=true)\|\|wait(2)\|\|StopSFX(thunder_strong_01) |


## 片段对话节点

片段对话节点的内容是普通对话的一部分，将会跟随在上一个普通对话节点或片段对话节点之后自动执行，对话节点的 `dialogueText` 字段中的值将会自动附加到上一段文字之后，并同时触发配置的脚本。

### 节点定义

`nodeType` 的值为 `[4]片段节点` 时，表示该节点为片段对话节点。

### 节点示例

| [nodeType]对话类型 | [nodeOptions]节点设置 | [dialogText]对话内容文本 |
|----------------|-------------------|--------------------|
| [4]片段节点        | WT 2.5            | 这是一句片段对话文本。        |

### 节点设置

片段对话节点的设置项为一个字符串代表两种片段的进入方式：
- `WI` 代表等待输入，将会等待用户输入后继续执行
- `WT <time>` 代表等待时间，将会等待指定时间后继续执行，`<time>` 为等待时间，单位为秒

### 相关属性

| 字段名                     | 说明                                                                                                   | 示例                                                                          |
|-------------------------|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| [nodeOption]节点设置        | 片段对话节点的配置项为一个字符串，格式形如等待输入 `WI` 或者等待时间 `WT <time>` 单位为秒。                                              | WT 2.5                                                                      |
| [bgpName]背景图变更          | 相当于直接调用 [行级脚本 SetLayerMedia](../scripts/line-scripts#setlayermedia-设置背景图层媒体)，与可填入的参数格式一致             | `p=Background, m=Fantasy Landscape, blend=hurricane, aud=true`              |
| [bgmName]音乐变更           | 相当于直接调用 [行级脚本 PlaySong](../scripts/line-scripts#playsong-播放背景音乐)，与可填入的参数格式一致                         | `Theme_21, l=true`                                                          |
| [characterTempId]角色模板Id | **将沿用上一条普通对话节点或片段对话节点的设置**                                                                           |                                                                             |
| [characterCode]角色代码     | **将沿用上一条普通对话节点或片段对话节点的设置**                                                                           |                                                                             |
| [speakerName]对话角色名文本    | 可为空，若不为空将会强制将对话者的姓名改为所填内容                                                                            |                                                                             |
| [dialogText]对话内容文本      | 对话的实际文本，将会添加在已有的文本之后                                                                                 | `这是一句<color=red>普通的</color>对话文本。`                                           |
| [tachieEnterType]立绘入场方式 | 当前接受两个值 `direct` , `fade` 代表直接显示和淡入，相当于直接调用 [行级脚本 Show](../scripts/line-scripts-character#show-显示角色) |                                                                             |
| [tachieStatus]立绘状态      | 设定立绘的状态，若不指定会使用默认状态，相当于直接调用 [行级脚本 SetSprite](../scripts/line-scripts-character#setsprite-设置立绘)       | `smile, l=0`                                                                |
| [commandsOnStart]开始触发   | 在对话开始时触发的脚本，格式遵循 [行级脚本](../scripts/line-scripts)                                                     | PlaySFX(thunder_strong_01, l=true)\|\|wait(2)\|\|StopSFX(thunder_strong_01) |

### 与普通对话节点的区别与使用说明

- 普通对话节点会清除现有对话框内的文字，并从头开始显示文字，而片段对话节点的内容将会自动附加到上一段文字之后。
- 一句对话通常由1个普通对话节点和0个或若干个片段对话节点组成，普通对话节点用于开头，片段对话节点用于追加后续内容。

以下是一个普通对话节点和片段对话节点的组合示例：

| [nodeType]对话类型 | [nodeOptions]节点设置 | [characterTempId]角色模板Id | [tachiePosition]立绘入场位置 | [tachieEnterType]立绘入场方式 | [dialogText]对话内容文本 | [commandsOnStart]开始触发                                  |
|----------------|-------------------|-------------------------|------------------------|-------------------------|--------------------|--------------------------------------------------------|
| [0]普通对话节点      |                   | [Slime]史莱姆              | [0, 0]                 | smooth                  | 让我想想我把它放哪了         |                                                        |
| [4]片段节点        | WT 1              |                         |                        |                         | ……是这里吗？            | [wait]Slime.Move(x=1, y=0)                             |
| [4]片段节点        | WT 1              |                         |                        |                         | ……还是这里？            | [wait]Slime.FaceLeft() \|\| [wait]Slime.Move(x=0, y=0) |
| [4]片段节点        | WT 3              |                         |                        |                         | ……找到了！             | Slime.FaceRight() \|\| [wait]Slime.Animate(Hop)        |

以上对话组合实现的效果为：
1. 史莱姆角色从左边缘淡入，说出“让我想想我把它放哪了”
2. 然后在1秒后说出“……是这里吗？”，并向右移动到右边缘
3. 再在1秒后说出“……还是这里？”，并转向左边，移动回原位
4. 最后在3秒后说出“……找到了！”，并转向右边，做出跳跃动作

## 控制节点

### 节点定义

`nodeType` 的值为 `[1]控制节点` 时，表示该节点为控制节点。

### 节点示例

以下是两个等价的示例

| [nodeType]对话类型 | [nodeOptions]节点设置                                                                                                                            | [dialogText]对话内容文本 |
|----------------|----------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
| [1]控制节点        | 100010020, charm > 20 and round < 5 \|\| 100010030                                                                                           |                    |                    |
| [1]控制节点        | [{ "condition": “charm > 20 and round < 5”, "turnId": 100010020, "commands": "" }, { "condition": “”, "turnId": 100010020, "commands": "" }] |                    |                    |


### 节点设置

简写方式： `<turnId> <condition>? || <turnId> <condition>? || ...`

完整字段列表：

| 字段        | 说明                                  | 示例                         |
|-----------|-------------------------------------|----------------------------|
| condition | 判断规则，用于判断是否执行以下的脚本或跳转指令             | `charm > 20 and round < 5` |
| turnId    | 跳转指令，此处应当填写跳转目标的 `dialogueId` ，可以为空 | 100010020                  |
| commands  | [行级脚本](../scripts/line-scripts)     |                            |

完整字段示例： 
```json
[
    { "condition": "charm > 20 and round < 5", "turnId": 100010020, "commands": "" },
    { "condition": "", "turnId": 100010020, "commands": "" }
]
```



### 相关属性

| 字段名                   | 说明                                                                                                                                            | 示例                                                                              |
|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| [nodeOption]节点设置      | 控制节点一般用于在特定条件下执行特定脚本或跳转到指定的对话Id，`condition` 字段格式遵循 [条件判断](../tables/conditional-judgement)， `commands` 字段格式遵循 [行级脚本](../scripts/line-scripts) |                                                                                 |
| [bgpName]背景图变更        | 相当于直接调用 [行级脚本 SetLayerMedia](../scripts/line-scripts#setlayermedia-设置背景图层媒体)，与可填入的参数格式一致                                                      | `p=Background, m=Fantasy Landscape, blend=hurricane, aud=true`                  |
| [bgmName]音乐变更         | 相当于直接调用 [行级脚本 PlaySong](../scripts/line-scripts#playsong-播放背景音乐)，与可填入的参数格式一致                                                                  | `Theme_21, l=true`                                                              |
| [dialogText]对话内容文本    | 对话的实际文本                                                                                                                                       | `这是一句<color=red>普通的</color>对话文本。`                                               |
| [commandsOnStart]开始触发 | 在对话开始时触发的脚本，格式遵循 [行级脚本](../scripts/line-scripts)                                                                                              | PlaySFX(thunder_strong_01, l=true) \|\| wait(2) \|\| StopSFX(thunder_strong_01) |


## 选择支节点

### 节点定义

`nodeType` 的值为 `[2]选择支节点` 时，表示该节点为选择支节点。

### 节点示例

以下是**带标题的**选择支节点示例与**不带标题**的选择支节点示例。

**节点设置中的选项数必须能与对话内容文本中的选项数一一对应或少1，否则会解析错误**

| [nodeType]对话类型 | [nodeOptions]节点设置                                                              | [dialogText]对话内容文本        |
|----------------|--------------------------------------------------------------------------------|---------------------------|
| [2]选择支节点       | 100010020 \|\| 100010030                                                       | 该如何回答？\|\| 我有意见 \|\| 我没意见 |
| [2]选择支节点       | [{ "turnId": 100010020, commands: "" }, { "turnId": 100010030, commands: "" }] | 该如何回答？\|\| 我有意见 \|\| 我没意见 |
| [2]选择支节点       | 100010020 \|\| 100010030                                                       | 我有意见 \|\| 我没意见            |


### 节点设置

简写方式： `<turnId> || <turnId> || ...`

完整字段列表：

| 字段        | 说明                                  | 示例                         |
|-----------|-------------------------------------|----------------------------|
| turnId    | 跳转指令，此处应当填写跳转目标的 `dialogueId` ，可以为空 | 100010020                  |
| commands  | [行级脚本](../scripts/line-scripts)     |                            |

完整字段示例：
```json
[
    { "turnId": 100010020, "commands": "" },
    { "turnId": 100010020, "commands": "" }
]
```


### 相关属性


| 字段名                   | 说明                                                                                       | 示例                                                                          |
|-----------------------|------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| [nodeOption]节点设置      | 用于配置选择支节点的选项和行为，格式见上方的例子，`commands` 字段格式遵循 [行级脚本](../scripts/line-scripts)               |                                                                             |
| [bgpName]背景图变更        | 相当于直接调用 [行级脚本 SetLayerMedia](../scripts/line-scripts#setlayermedia-设置背景图层媒体)，与可填入的参数格式一致 | `p=Background, m=Fantasy Landscape, blend=hurricane, aud=true`              |
| [bgmName]音乐变更         | 相当于直接调用 [行级脚本 PlaySong](../scripts/line-scripts#playsong-播放背景音乐)，与可填入的参数格式一致             | `Theme_21, l=true`                                                          |
| [dialogText]对话内容文本    | 由 `\|\|` 分割不同选项的文字，若数量比 `nodeOptions` 多1，则第一个选项会作为标题，否则应当与 `nodeOptions` 中的选项一一对应        | `该如何回答？\|\| 我有意见 \|\| 我没意见` 或 `我有意见 \|\| 我没意见`                              |
| [commandsOnStart]开始触发 | 在对话开始时触发的脚本，格式遵循 [行级脚本](../scripts/line-scripts)                                         | PlaySFX(thunder_strong_01, l=true)\|\|wait(2)\|\|StopSFX(thunder_strong_01) |


## 输入框节点

### 节点定义

`nodeType` 的值为 `[3]输入框节点` 时，表示该节点为输入框节点。

### 节点示例

| [nodeType]对话类型 | [nodeOptions]节点设置 | [dialogText]对话内容文本 |
|----------------|-------------------|--------------------|
| [3]输入框节点       | money             |                    |

### 节点设置

节点设置格式： `<varName>` ，其中 `<varName>` 为内置变量名，用于接收输入的值。

### 相关属性

无

