# StoryPerformData.json

本节是对于MainStoryData.xlsx表中StoryPerformData.json文件中，较为复杂字段的解释。

## nodeType 节点类型

本字段为枚举值，用于标识节点的类型，不同的节点类型会有不同的行为。

| 值         | 含义   | 说明                 |
|-----------|------|--------------------|
| dialogue  | 对话   | 用于展示对话文本的基本节点。     |
| selection | 选择支  | 用于展示选项并转到特定的对话中。   |
| control   | 控制节点 | 仅用于触发脚本或进行特定操作的节点。 |

## nodeOptions 节点选项

本字段为节点的配置项，不同的节点类型会有不同的配置项，并且对于每一个有内容的配置项都有缩写形式和完整形式。

### dialogue 对话节点

无特殊配置项。

### selection 选择支节点

- 缩写形式例子

| [nodeType]对话类型  | [nodeOptions]节点设置      | [dialogText]对话内容文本 |
|-----------------|------------------------|--------------------|
| [selection] 选择支 | 100010008\|\|100010009 | 我有意见\|\|我没意见       |

以上的例子中，nodeOptions字段中的内容为`100010008||100010009`，其中`100010008`和`100010009`是两个对话节点的id，用于表示该选择支将跳转到哪一条对话，`我有意见`和`我没意见`是两个选项的文本内容。

- 完整形式

| [nodeType]对话类型  | [nodeOptions]节点设置                                                            | [dialogText]对话内容文本 |
|-----------------|------------------------------------------------------------------------------|--------------------|
| [selection] 选择支 | `[{turnId: "100010008", commands: ""}, {turnId: "100010009", commands: ""}]` | 我有意见\|\|我没意见       |

以上的例子的作用与缩写形式相同，区别在于完整形式中的nodeOptions字段是一个数组，数组中的每一个元素都是一个对象，对象中包含了两个字段，`turnId`表示跳转到的对话节点的id，`commands`表示在跳转到该对话节点时需要执行的脚本。

此处 `commands` 字段的格式与 [行级脚本](../scripts/line-scripts) 中的格式相同。

### control 控制节点

在同时存在多个跳转目标时，系统将会根据配置的顺序依次进行条件判断，直到找到第一个满足条件的跳转目标。

- 缩写形式例子

| [nodeType]对话类型 | [nodeOptions]节点设置                                     |
|----------------|-------------------------------------------------------|
| [control] 控制节点 | charm>50,100010007\|\|charm>20,100010008\|\|100010009 |

以上的例子中，nodeOptions字段中的内容为`charm>50,100010007||charm>20,100010008||100010009`，其中`charm>50`、`charm>20`是条件判断，`100010007`、`100010008`、`100010009` 是两个对话节点的id，用于表示该控制节点将根据条件判断跳转到哪一条对话。

这个例子的实际作用是：如果魅力值大于50，跳转到100010007；如果魅力值大于20，跳转到100010008；否则跳转到100010009。

如果不需要进行条件判断，可以将控制节点直接用作跳转节点，例如：

| [nodeType]对话类型 | [nodeOptions]节点设置 |
|----------------|-------------------|
| [control] 控制节点 | 100010008         |

在这个例子中，控制节点将无条件直接跳转到100010008。

缩写形式中，`condition` 的格式与 [条件判断](../tables/conditional-judgement) 中的格式相同。

- 完整形式

| [nodeType]对话类型 | [nodeOptions]节点设置                                                                                                                                 |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| [control] 控制节点 | `[{condition: "charm>50", turnId: "100010007", commands: ""}, {condition: "charm>20", turnId: "100010008", commands: ""}, {turnId: "100010009"}]` |

以上的例子的作用与缩写形式相同，区别在于完整形式中的nodeOptions字段是一个数组，数组中的每一个元素都是一个对象，对象中包含了三个字段，`condition`表示条件判断，`turnId`表示跳转到的对话节点的id，`commands`表示在跳转到该对话节点时需要执行的脚本。

脚本的格式与 [行级脚本](../scripts/line-scripts) 中的格式相同。

`condition` 字段的格式与 [条件判断](../tables/conditional-judgement) 中的格式相同。

## tachieEnterType 角色进场类型

本字段为枚举值，用于标识角色的进场方式。\
当前没有设计多种的角色进场方式，所以该字段可以为任意值，在系统进行处理时仅判断是否为空。

## tachiePosition 角色位置

本字段用于设置角色的位置，格式为： `[数字, 数字]`，第一个数字表示角色的横向位置，第二个数字表示角色的纵向位置，例如：
```text
[0.2, 0.5]
```

> **定位数字的含义**
> - 对于横向位置，0表示立绘将会靠着左边界放置，1表示立绘将会靠着右边界放置。
> - 对于纵向位置，0表示立绘将会靠着上边界放置，1表示立绘将会靠着下边界放置。
> - 对于介于0和1之间的数字，表示立绘将会在两个边界按照线性比例进行放置。例如，0.5表示立绘将会在横向或纵向的中间位置。
> - 但是定位数字并不仅限于0到1之间，可以使用负数或大于1的值，例如-1或者2，表示立绘将会超出边界。
 
## tachieStatus 立绘状态

本字段用于设置立绘的状态，不同的角色支持的状态不同。

对于Sprite类型的单层立绘，状态通常为一个字符串，例如：
```text
smile
```

对于Sprite类型的多层立绘，状态通常为一个数组，数组中的每一个元素都是一个 `layer` 和 `status` 的结构 ，例如：
```text
[ { layer: 0, status: "body_side" }, { layer: 1, status: "face_smile_2" } ]
```

## dialogueText 对话文本

本字段支持富文本，可以使用 [富文本](../commonly-used/rich-text) 对文本进行修饰。

## characterTempId 角色模板

本字段用于设置角色的模板，用于在系统中使用对应的模板进行创建角色。\
本字段请务必使用表格中的枚举值，不要使用其他值，否则无法正确创建角色。

## characterCode 角色代码
本字段大部分情况下可以忽略，默认会使用与角色模板 `characterTempId` 对应的内置值，只有需要使用同一个角色模板创建多个角色时才需要使用，用于区分同一角色模板的不同角色。

例如：
- 多个卫兵角色，但是他们的对话内容不同，会有多个卫兵同时在场，可以使用同一个卫兵模板，但是角色代码不同。
- 重要角色与他的分身或者幻影对话，可以使用同一个角色模板，但是角色代码不同。

使用示例：

| characterTempId | characterCode | dialogText  |
|-----------------|---------------|-------------|
| guardian        | guardian_1    | 刚才是什么东西跑过去了 |
| guardian        | guardian_2    | 不知道         |
| guardian        | guardian_3    | 我也没看清       |

这样的对话将会将会在游戏中同时出现三个使用同一个立绘的卫兵，分别说出不同的对话。

## commandsOnStart 起始执行脚本

本字段用于设置在对话开始时需要执行的脚本，用于在对话开始时进行一些特殊操作。填写格式请参考 [行级脚本](../scripts/line-scripts) 。

