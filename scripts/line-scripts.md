# 行级脚本【通用】

行级脚本是在一段对话 `dialogue` 开始或者结束时触发的脚本，应当在 `MainStoryData.xlsx` 表中的 `StoryPerformData.json` 中的 [commandsOnStart](../tables/story-dialogue#commandsonstart-起始执行脚本) 字段与 <s>commandsOnEnd（当前未实现，有需要再加）</s> 中定义。

以下是一个完整的使用例子：

```text
CreateCharacter(Succubus, characterCode=Succubus_1, enable=false) ||
[wait]Show(Succubus_1) ||
CreateCharacter(Slime, c=Slime_1, e=true)
```

*本节的示例部分为便于阅读添加了空格和换行，实际书写时可以自行调整排版，特殊符号（逗号、括号、等号、双竖线等）两侧的不可见字符不影响脚本的执行。*

## 行级脚本的基本结构

一组行级脚本由多个脚本组成，每个脚本之间使用 `||` 分隔，每个脚本的基本结构如下：

- `[wait]` 前缀（非必须），表示此脚本执行完成后才会执行下一个脚本。**（仅可用于协程脚本，非协程脚本添加无效）**
- `ScriptName` 脚本名称，表示调用的是哪个脚本。
- `(arg0, arg1, param=value)` 表示调用的参数。
> 关于参数的说明：
> - `arg0`、`arg1`为脚本的基本参数，通常会有数个不定量的基本参数，参数之间使用逗号分隔。
> - `param=value`为脚本的配置参数，不分先后，通常是**非必填的**，针对特定脚本仅有有限个可以使用的配置参数，参数之间使用逗号分隔，参数名与参数值之间使用等号分隔。
> - 若脚本没有参数，不可以省略括号，应当使用 `()` 表示没有参数。


## wait 等待

### 基本属性

考虑到wait的效果，wait脚本将强制为协程脚本，这意味着他将必定会延迟后续脚本的触发，无论是否添加`[wait]`前缀。

| 属性      | 值   |
|---------|-----|
| 是否是协程脚本 | 强制是 |

### 基本参数

| 参数名  | 说明       | 类型       | 数量 |
|------|----------|----------|----|
| time | 延迟时间，单位秒 | 小数 float | 1  |

### 配置参数

无

### 使用示例

```text
wait(1.5)
```

## ShowUI 显示UI

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明           |
|-----------|-----|-------------|-------|--------------|
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数     |
| immediate | i   | 布尔值 boolean | false | 是否跳过过渡动画直接显示 |

### 使用示例

```text
[wait]ShowUI(spd=1.5, i=false)
```

## HideUI 隐藏UI

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明           |
|-----------|-----|-------------|-------|--------------|
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数     |
| immediate | i   | 布尔值 boolean | false | 是否跳过过渡动画直接显示 |

### 使用示例

```text
[wait]HideUI(spd=1.5, i=false)
```

## ShowDB 显示对话框

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明           |
|-----------|-----|-------------|-------|--------------|
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数     |
| immediate | i   | 布尔值 boolean | false | 是否跳过过渡动画直接显示 |

### 使用示例

```text
[wait]ShowDB(spd=1.5, i=false)
```

## HideDB 隐藏对话框

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明           |
|-----------|-----|-------------|-------|--------------|
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数     |
| immediate | i   | 布尔值 boolean | false | 是否跳过过渡动画直接显示 |

### 使用示例

```text
[wait]HideDB(spd=1.5, i=false)
```

## LoadChapter 载入章节

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名         | 说明   | 类型  | 数量 |
|-------------|------|-----|----|
| chapterCode | 章节代码 | 字符串 | 1  |

### 配置参数

| 参数名      | 缩写 | 类型          | 默认值  | 说明             |
|----------|----|-------------|------|----------------|
| enqueue  | e  | 布尔值 boolean | true | 判断插入章节还是替换当前章节 |
| priority | p  | 布尔值 boolean | true | 是否优先进行读取的章节    |

### 使用示例

```text
LoadChapter(0_1, e=true, p=true)
```

### 具体效果说明

1. 当 `enqueue` 为 `true` 且 `priority` 为 `true` 时，将会插入新的章节并从下一句开始执行新的章节，新插入的章节执行完成后将会继续执行原章节。
2. 当 `enqueue` 为 `true` 且 `priority` 为 `false` 时，读取的新章节将会添加到章节队列的末尾，等待当前章节执行完成后再执行新章节。
3. 当 `enqueue` 为 `false` 时，章节列表将会清空，并将当前章节替换为新的章节，新章节将会从头开始执行。


## PlaySFX 播放音效

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明                             | 类型  | 数量 |
|----------|--------------------------------|-----|----|
| filePath | 音效文件的路径，将会映射到资源目录 `Audio/SFX/` | 字符串 | 1  |

### 配置参数

| 参数名    | 缩写     | 类型          | 默认值   | 说明            |
|--------|--------|-------------|-------|---------------|
| volume | v, vol | 小数 float    | 1.0f  | 音量大小          |
| pitch  | p      | 小数 float    | 1.0f  | 音调大小，将会改变音频长度 |
| loop   | l      | 布尔值 boolean | false | 是否循环播放        |

### 使用示例

```text
PlaySFX(thunder_strong_01, l=true)
```

## StopSFX 停止播放音效

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明          | 类型  | 数量 |
|----------|-------------|-----|----|
| fileName | 要停止的音效文件的名称 | 字符串 | 1  |

### 配置参数

无

### 使用示例

```
StopSFX(thunder_strong_01)
```

## PlayVoice 播放语音

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明                                | 类型  | 数量 |
|----------|-----------------------------------|-----|----|
| filePath | 语音文件的路径，将会映射到资源目录 `Audio/Voices/` | 字符串 | 1  |

### 配置参数

| 参数名    | 缩写     | 类型          | 默认值   | 说明            |
|--------|--------|-------------|-------|---------------|
| volume | v, vol | 小数 float    | 1.0f  | 音量大小          |
| pitch  | p      | 小数 float    | 1.0f  | 音调大小，将会改变音频长度 |
| loop   | l      | 布尔值 boolean | false | 是否循环播放        |

### 使用示例

```text
PlayVoice(char_smile_01)
```

## StopVoice 停止播放语音

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明          | 类型  | 数量 |
|----------|-------------|-----|----|
| fileName | 要停止的语音文件的名称 | 字符串 | 1  |

### 配置参数

无

### 使用示例

```
StopSFX(thunder_strong_01)
```

## PlaySong 播放背景音乐

**注意：背景音乐和环境音效共享音轨，背景音乐音轨编号默认为1，环境音效音轨编号默认为0**

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明                                | 类型  | 数量 |
|----------|-----------------------------------|-----|----|
| filePath | 背景音乐文件路径，将会映射到资源目录 `Audio/Music/` | 字符串 | 1  |

### 配置参数

| 参数名     | 缩写 | 类型     | 默认值 | 说明   |
|---------|----|--------|-----|------|
| channel | c  | 整数 int | 1   | 音轨编号 |

### 使用示例

```text
PlaySong(Theme_21, l=true)
```

## StopSong 停止播放背景音乐

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名           | 说明       | 类型     | 默认值 | 数量 |
|---------------|----------|--------|-----|----|
| trackNum 音轨编号 | 要停止的音轨编号 | 整数 int | 1   | 1  |

### 配置参数

无

### 使用示例

```text
StopSong()
```

## PlayAmbience 播放环境音效

**注意：背景音乐和环境音效共享音轨，背景音乐音轨编号默认为1，环境音效音轨编号默认为0**

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名      | 说明                                   | 类型  | 数量 |
|----------|--------------------------------------|-----|----|
| filePath | 环境音效文件路径，将会映射到资源目录 `Audio/Ambience/` | 字符串 | 1  |

### 配置参数

| 参数名     | 缩写 | 类型     | 默认值 | 说明   |
|---------|----|--------|-----|------|
| channel | c  | 整数 int | 0   | 音轨编号 |

### 使用示例

```text
PlayAmbience(RainyMood)
```

## StopAmbience 停止播放环境音效

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名           | 说明       | 类型     | 默认值 | 数量 |
|---------------|----------|--------|-----|----|
| trackNum 音轨编号 | 要停止的音轨编号 | 整数 int | 0   | 1  |

### 配置参数

无

### 使用示例

```text
StopAmbience()
```

## Show 显示角色

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

| 参数名               | 说明             | 类型  | 数量 |
|-------------------|----------------|-----|----|
| characterKey 角色标识 | 要切换为显示状态的角色Key | 字符串 | 不限 |

关于角色Key的获取方式，请参考 [角色标识](../system/character-key) 一节的内容。

### 配置参数

| 参数名       | 缩写 | 类型          | 默认值   | 说明           |
|-----------|----|-------------|-------|--------------|
| immediate | i  | 布尔值 boolean | false | 是否跳过过渡动画直接显示 |

### 使用示例

```text
[wait]Show(Succubus_1)

Show(Succubus_1, Slime_1, Generic_1)

以下是三个等价的示例：
[wait]Show(Succubus_1, Slime_1, immediate=false)
[wait]Show(Succubus_1, Slime_1, i=false)
[wait]Show(Succubus_1, Slime_1)
```

## Hide 隐藏角色

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

| 参数名               | 说明             | 类型  | 数量 |
|-------------------|----------------|-----|----|
| characterKey 角色标识 | 要切换为隐藏状态的角色Key | 字符串 | 不限 |

关于角色Key的获取方式，请参考 [角色标识](../system/character-key) 一节的内容。

### 配置参数

| 参数名       | 缩写 | 类型          | 默认值   | 说明           |
|-----------|----|-------------|-------|--------------|
| immediate | i  | 布尔值 boolean | false | 是否跳过过渡动画直接隐藏 |

### 使用示例

```
[wait]Hide(Succubus_1)

Hide(Succubus_1, Slime_1, Generic_1)

以下是三个等价的示例：
[wait]Hide(Succubus_1, Slime_1, immediate=false)
[wait]Hide(Succubus_1, Slime_1, i=false)
[wait]Hide(Succubus_1, Slime_1)
```

## CreateCharacter 创建角色

用于特殊情况下手动创建角色，通常角色会在对话中自动创建，详细的创建时机请参考 [角色的创建时机](../system/character-key#角色的创建时机) 一节的内容。

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名             | 说明     | 类型  | 数量 |
|-----------------|--------|-----|----|
| characterTempId | 角色模板Id | 字符串 | 1  |

### 配置参数

| 参数名           | 缩写 | 类型          | 默认值   | 说明             |
|---------------|----|-------------|-------|----------------|
| characterCode | c  | 字符串 string  |       | 角色代码           |
| enable        | e  | 布尔值 boolean | false | 是否在创建完成后直接显示角色 |
| immediate     | i  | 布尔值 boolean | false | 是否跳过淡入动画       |

### 使用示例

```text
CreateCharacter(Succubus)
CreateCharacter(Slime, e=true)
CreateCharacter(Slime, c=Slime_1, e=true)
CreateCharacter(Succubus, characterCode=Succubus_1, enable=false)
```


## MoveCharacter 移动角色立绘

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名               | 说明             | 类型  | 数量 |
|-------------------|----------------|-----|----|
| characterKey 角色标识 | 要切换为非高亮状态的角色标识 | 字符串 | 不限 |

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明           |
|-----------|-----|-------------|-------|--------------|
| x         |     | 小数 float    | 0     | 移动目标的横轴坐标    |
| y         |     | 小数 float    | 0     | 移动目标的纵轴坐标    |
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数     |
| smooth    | s   | 布尔值 boolean | false | 是否进行非线性的平滑移动 |
| immediate | i   | 布尔值 boolean | false | 是否跳过过渡动画直接移动 |

### 使用示例

```text
MoveCharacter(Succubus_1, x=0, y=0, spd=0.1, s=true)
```

## Sort 排序角色图层

本脚本的具体效果请参考 [角色图层与优先级设置](../system/character-layer-and-priority#手动设置优先级) 一节的内容。

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名          | 说明   | 类型  | 数量 |
|--------------|------|-----|----|
| characterKey | 角色标识 | 字符串 | 不限 |

### 配置参数

无

### 使用示例

```text
Sort(Char_1, Char_2, Char_3)
```


## HighlightAll 高亮所有角色

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名               | 说明            | 类型  | 数量 |
|-------------------|---------------|-----|----|
| characterKey 角色标识 | 要切换为高亮状态的角色标识 | 字符串 | 不限 |

### 配置参数

| 参数名       | 缩写 | 类型          | 默认值   | 说明                      |
|-----------|----|-------------|-------|-------------------------|
| immediate | i  | 布尔值 boolean | false | 是否跳过淡入动画                |
| only      | o  | 布尔值 boolean | false | 是否将不在列表中的其他所有角色设置为非高亮状态 |

### 使用示例

```text
[wait]HighlightAll(Char_1, Char_2, only=true)
```

## UnHighlightAll 非高亮所有角色

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 否 |

### 基本参数

| 参数名               | 说明             | 类型  | 数量 |
|-------------------|----------------|-----|----|
| characterKey 角色标识 | 要切换为非高亮状态的角色标识 | 字符串 | 不限 |

### 配置参数

| 参数名       | 缩写 | 类型          | 默认值   | 说明                     |
|-----------|----|-------------|-------|------------------------|
| immediate | i  | 布尔值 boolean | false | 是否跳过淡入动画               |
| only      | o  | 布尔值 boolean | false | 是否将不在列表中的其他所有角色设置为高亮状态 |

### 使用示例

```text
[wait]UnHighlightAll(Char_1, Char_2, only=true)
```


## SetLayerMedia 设置背景图层媒体

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值   | 说明                                                                                                   |
|-----------|-----|-------------|-------|------------------------------------------------------------------------------------------------------|
| panelName | p   | 字符串 string  |       | 面板代码，可选值为 `Background` 或 `Cinematic` 或 `Foreground` ，关于图层的层叠关系，请参考 [对话界面图层顺序](../system/layer-order) |
| layer     | l   | 整数 int      | 0     | 图层编号                                                                                                 |
| media     | m   | 字符串         |       | 需要作为背景的媒体文件名称，将会优先在 `Graphics/BG Images/` 目录下寻找，若找不到则会在 `Graphics/BG Videos/` 文件夹中寻找                 |
| immediate | i   | 布尔值 boolean | false | 是否跳过淡入动画                                                                                             |
| speed     | spd | 小数 float    | 1.0   | 过渡动画加速倍数                                                                                             |
| blend     | b   | 字符串         |       | 使用的过渡特效素材，素材放置于 `Graphics/Transition Effects/` 文件夹下                                                  |
| useAudio  | aud | 布尔值 boolean | false | 是否启用视频媒体文件自带的背景音（仅适用于 `Graphics/BG Videos/` 文件夹下的视频文件。                                               |

### 使用示例

```text
SetLayerMedia(p=Background, m=Fantasy Landscape, blend=hurricane, aud=true)
```

## ClearLayerMedia 清除背景图层媒体

### 基本属性

| 属性      | 值 |
|---------|---|
| 是否是协程脚本 | 是 |

### 基本参数

无

### 配置参数

| 参数名       | 缩写  | 类型          | 默认值        | 说明                                                                                                   |
|-----------|-----|-------------|------------|------------------------------------------------------------------------------------------------------|
| panelName | p   | 字符串 string  | Background | 面板代码，可选值为 `Background` 或 `Cinematic` 或 `Foreground` ，关于图层的层叠关系，请参考 [对话界面图层顺序](../system/layer-order) |
| layer     | l   | 整数 int      | -1         | 图层编号，若为 `-1` 则清空此面板下所有图层                                                                             |
| immediate | i   | 布尔值 boolean | false      | 是否跳过淡入动画                                                                                             |
| speed     | spd | 小数 float    | 1.0        | 过渡动画加速倍数                                                                                             |
| blend     | b   | 字符串         |            | 使用的过渡特效素材，素材放置于 `Graphics/Transition Effects/` 文件夹下                                                  |

### 使用示例

```text
[wait]ClearLayerMedia(p=Cinematic, i=true)
```
